const GhadirPause=30,datePicker=document.getElementById("datepicker"),timePicker=document.getElementById("timepicker");var TotalTimeOfYourBooking=0,supabaseData=[];function renderWeek(date,setDatePicker=!0){if(setDatePicker){const oneDayAhead=new Date(date)<=new Date?new Date:new Date(date);"sunday"==oneDayAhead.toLocaleString("en",{weekday:"long"}).toLowerCase()&&oneDayAhead.setDate(oneDayAhead.getDate()-1),oneDayAhead.setDate(oneDayAhead.getDate()+1),oneDayAhead.setHours(13,0,0,0);flatpickr(datePicker,{locale:"da",dateFormat:"d-m-Y",weekNumbers:!0,minDate:"today"}).setDate(oneDayAhead,!0);flatpickr(timePicker,{locale:"da",enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,minTime:"08:00",maxTime:"17:00",minuteIncrement:10}).setDate(oneDayAhead,!0)}if(document.querySelector(".your-booking")&&addYourTimeKaldender(0),document.getElementById("week").textContent.replace("Uge ","")!=getWeekNumber(date)&&(document.querySelectorAll(".booking-time").forEach((time=>{time.classList.contains("your-booking")||time.remove()})),insertAllreadyBookedBookings(date)),document.getElementById("week").textContent="Uge "+getWeekNumber(date),getWeekDates(date).forEach(((day,index)=>{document.getElementById("date"+index).textContent=day})),validateBooking(!1)){document.querySelectorAll(".go_to_booking").forEach((submitButton=>submitButton.classList.remove("disabled")))}else{document.querySelectorAll(".go_to_booking").forEach((submitButton=>{submitButton.classList.contains("disabled")||submitButton.classList.add("disabled")}))}}function addService(service){const selectedServices=document.getElementById("selected_services_list"),newService=document.createElement("div");newService.classList.add("serviceitem"),selectedServices.appendChild(newService);const service_label=service.split("%")[0],service_duration=Number(service.split("%")[1]),service_price=service.split("%")[2],service_price_formated=Number(service_price).toLocaleString("de-DE"),service_andtal_personer=Number(service.split("%")[3]),service_andtal_personer_formated=service_andtal_personer<=1?service_andtal_personer+" person":service_andtal_personer+" personer",service_inkl=service.split("%")[4],icon=document.createElement("span");icon.innerHTML='<svg width="20" height="20" viewBox="0 0 17 17" xmlns="http://www.w3.org/2000/svg"><path d="M5.33887 14.7065C4.9722 14.7065 4.65831 14.576 4.3972 14.3149C4.13609 14.0538 4.00553 13.7399 4.00553 13.3732V4.70654H3.33887V3.37321H6.6722V2.70654H10.6722V3.37321H14.0055V4.70654H13.3389V13.3732C13.3389 13.7399 13.2083 14.0538 12.9472 14.3149C12.6861 14.576 12.3722 14.7065 12.0055 14.7065H5.33887ZM12.0055 4.70654H5.33887V13.3732H12.0055V4.70654ZM6.6722 12.0399H8.00553V6.03988H6.6722V12.0399ZM9.33887 12.0399H10.6722V6.03988H9.33887V12.0399Z"/></svg>',icon.addEventListener("click",(()=>{newService.remove(),addYourTimeKaldender(-service_duration)})),newService.innerHTML='<div class="service-top"><span class="service">'+service_label+'</span><span class="price">'+service_price_formated+' Kr.</span></div><div class="service-bottom"><div class="genneral-info"><span>Servicen gælder '+service_andtal_personer_formated+"</span><span>Inkl. "+service_inkl+'</span></div> <div><span class="duration">'+service_duration+" min</span></div></div>";newService.querySelector(".service-top").appendChild(icon),addYourTimeKaldender(service_duration)}function addYourTimeKaldender(time){TotalTimeOfYourBooking+=time;const dateName=stringToDateObject(datePicker.value+" "+timePicker.value).toLocaleDateString("en-US",{weekday:"long"}),yourTime=document.querySelector(".your-booking");yourTime&&yourTime.remove(),TotalTimeOfYourBooking<=0?addTimeToKaldender(dateName.toLocaleLowerCase(),timePicker.value,TotalTimeOfYourBooking,!0):addTimeToKaldender(dateName.toLocaleLowerCase(),timePicker.value,TotalTimeOfYourBooking+GhadirPause,!0)}function getSelectedServices(){const selectedServices={},splitedDate=datePicker.value.split("-");selectedServices.datetime=splitedDate[2]+splitedDate[1]+splitedDate[0]+"T"+timePicker.value+":00.000Z";var totalPrice=0;return selectedServices.services=[],document.querySelectorAll("#selected_services_list .serviceitem").forEach((service=>{const name=service.querySelector(".service").textContent,time=Number(service.querySelector(".duration").textContent.split(" ")[0]),price=Number(service.querySelector(".price").textContent.replace(".","").split(" ")[0]),serviceObject={};serviceObject.service=name,serviceObject.tid=time,serviceObject.pris=price,totalPrice+=price,selectedServices.services.push(serviceObject)})),selectedServices.totalTime=TotalTimeOfYourBooking+GhadirPause,selectedServices.totalPrice=totalPrice,selectedServices}function validateBooking(giveMessage=!0){if(!supabaseData)return!0;function timeToMinutes(timeStr){const[hours,minutes]=timeStr.split(":").map(Number);return 60*hours+minutes}const selectedDate=stringToDateObject(datePicker.value+" "+timePicker.value).toISOString().split("T")[0],yourStartMinutes=timeToMinutes(timePicker.value),yourEndMinutes=yourStartMinutes+TotalTimeOfYourBooking+GhadirPause;if(yourEndMinutes>=1050)return giveMessage&&alert("Din tid er ude for kaldender"),!1;if(TotalTimeOfYourBooking<=0)return giveMessage&&alert("Vælg venligst en service"),!1;let somethingIsBooked=!1;return supabaseData.forEach((element=>{if(element.start_time.split("T")[0]!==selectedDate)return;const bookingStartMinutes=timeToMinutes(element.start_time.split("T")[1].slice(0,5)),bookingEndMinutes=bookingStartMinutes+element.duration;var end1,start2;end1=yourEndMinutes,start2=bookingStartMinutes,yourStartMinutes<bookingEndMinutes&&start2<end1&&(somethingIsBooked=!0,giveMessage&&alert("Denne tid eller noget af denne tid er allerede booket"))})),!somethingIsBooked}function renderServiceOptions(){const selector=document.getElementById("add_services");fetch("pakker.json").then((response=>response.json())).then((data=>{data.forEach((service=>{const option=document.createElement("option");option.value=service.label+"%"+service.duration+"%"+service.price+"%"+service.antal_personer+"%"+service.inkl,option.textContent=service.label,selector.appendChild(option)}))}))}async function insertAllreadyBookedBookings(currentDate){function getNextSunday(date=new Date){const daysUntilSunday=(7-date.getDay())%7;return date.setDate(date.getDate()+daysUntilSunday),date.setHours(23,59,59,999),date.toISOString()}function getPreviousMonday(date=new Date){const daysSinceMonday=(date.getDay()+6)%7;return date.setDate(date.getDate()-daysSinceMonday+1),date.setHours(0,0,0,0),date.toISOString()}supabaseData=[];const{access_token:access_token}=await signIn(),requestBookingResponse=await fetch(`${supabaseUrl}/rest/v1/requestBooking?start_time=gte.${getPreviousMonday(currentDate)}&start_time=lte.${getNextSunday(currentDate)}&select=start_time,duration`,{method:"GET",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"}}),requestBookingData=await requestBookingResponse.json();requestBookingResponse.ok?requestBookingData.forEach((item=>{const day=new Date(item.start_time).toLocaleString("en",{weekday:"long"}).toLowerCase(),start_time=item.start_time.split("T")[1].slice(0,-3),duration=item.duration;supabaseData.push(item),addTimeToKaldender(day,start_time,duration)})):console.error("Fetch failed:",requestBookingData);const acceptedBookingResponse=await fetch(`${supabaseUrl}/rest/v1/acceptedBooking?start_time=gte.${getPreviousMonday(currentDate)}&start_time=lte.${getNextSunday(currentDate)}&select=start_time,duration`,{method:"GET",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"}}),acceptedBookingData=await acceptedBookingResponse.json();acceptedBookingResponse.ok?acceptedBookingData.forEach((item=>{const day=new Date(item.start_time).toLocaleString("en",{weekday:"long"}).toLowerCase(),start_time=item.start_time.split("T")[1].slice(0,-3),duration=item.duration;supabaseData.push(item),addTimeToKaldender(day,start_time,duration)})):console.error("Fetch failed:",acceptedBookingData)}document.addEventListener("DOMContentLoaded",(()=>{const prevArrow=document.getElementById("prev_week");prevArrow.classList.add("arrow-disabled");const nextArrow=document.getElementById("next_week");let currentDate=new Date;const servicePicker=document.getElementById("add_services");renderWeek(currentDate),renderServiceOptions(),nextArrow.addEventListener("click",(()=>{prevArrow.classList.contains("arrow-disabled")&&prevArrow.classList.remove("arrow-disabled"),currentDate.setDate(currentDate.getDate()+7),renderWeek(currentDate)})),prevArrow.addEventListener("click",(()=>{currentDate.setDate(currentDate.getDate()-7),currentDate<new Date&&(currentDate=new Date,prevArrow.classList.add("arrow-disabled")),renderWeek(currentDate)})),timePicker.addEventListener("change",(()=>{const selectedDate=new Date(stringToDateObject(datePicker.value+" "+timePicker.value));currentDate=selectedDate,renderWeek(currentDate,!1)})),datePicker.addEventListener("change",(()=>{const selectedDate=new Date(stringToDateObject(datePicker.value+" "+timePicker.value));currentDate=selectedDate,renderWeek(currentDate,!1)})),servicePicker.addEventListener("change",(()=>{addService(servicePicker.value),servicePicker.value="default"}));document.querySelectorAll(".go_to_booking").forEach((bookingbotton=>{bookingbotton.addEventListener("click",(event=>{event.preventDefault(),validateBooking()&&(localStorage.setItem("selectedservices",JSON.stringify(getSelectedServices())),window.location="booking2.html")}))}))}));