function renderWeek(date){document.getElementById("week").textContent.replace("Uge ","")!=getWeekNumber(date)&&(document.querySelectorAll(".booking-time").forEach((time=>{time.classList.contains("your-booking")||time.remove()})),document.querySelectorAll(".booking-item").forEach((item=>{item.remove()})),insertBookings(date)),document.getElementById("week").textContent="Uge "+getWeekNumber(date),getWeekDates(date).forEach(((day,index)=>{document.getElementById("date"+index).textContent=day}))}document.addEventListener("DOMContentLoaded",(async()=>{const prevArrow=document.getElementById("prev_week");prevArrow.classList.add("arrow-disabled");const nextArrow=document.getElementById("next_week");let currentDate=new Date;const anmodningerTab=document.getElementById("anmodninger"),godkendteTab=document.getElementById("godkendte");anmodningerTab.addEventListener("click",(()=>{anmodningerTab.classList.contains("active-tab")||(anmodningerTab.classList.add("active-tab"),godkendteTab.classList.remove("active-tab"),document.getElementById("requested").style.display="flex",document.getElementById("accepteret").style.display="none",calcHeightOnChildItems(document.getElementById("requested")))})),godkendteTab.addEventListener("click",(()=>{godkendteTab.classList.contains("active-tab")||(godkendteTab.classList.add("active-tab"),anmodningerTab.classList.remove("active-tab"),document.getElementById("requested").style.display="none",document.getElementById("accepteret").style.display="flex",calcHeightOnChildItems(document.getElementById("accepteret")))})),nextArrow.addEventListener("click",(()=>{prevArrow.classList.contains("arrow-disabled")&&prevArrow.classList.remove("arrow-disabled"),currentDate.setDate(currentDate.getDate()+7),renderWeek(currentDate)})),prevArrow.addEventListener("click",(()=>{currentDate.setDate(currentDate.getDate()-7),currentDate<new Date&&(currentDate=new Date,prevArrow.classList.add("arrow-disabled")),renderWeek(currentDate)})),renderWeek(currentDate)}));var supabaseData=[];async function insertBookings(currentDate){function getNextSunday(date=new Date){const daysUntilSunday=(7-date.getDay())%7;return date.setDate(date.getDate()+daysUntilSunday),date.setHours(23,59,59,999),date.toISOString()}function getPreviousMonday(date=new Date){const daysSinceMonday=(date.getDay()+6)%7;return date.setDate(date.getDate()-daysSinceMonday+1),date.setHours(0,0,0,0),date.toISOString()}supabaseData=[];const{access_token:access_token}=await adminLogin(),requestBookingResponse=await fetch(`${supabaseUrl}/rest/v1/requestBooking?start_time=gte.${getPreviousMonday(currentDate)}&start_time=lte.${getNextSunday(currentDate)}`,{method:"GET",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"}}),requestBookingData=await requestBookingResponse.json();requestBookingResponse.ok?requestBookingData.forEach((item=>{const day=new Date(item.start_time).toLocaleString("en",{weekday:"long"}).toLowerCase(),start_time=item.start_time.split("T")[1].slice(0,-3),duration=item.duration;supabaseData.push(item),addTimeToKaldender(day,start_time,duration,!1,"#eeb579","R"+item.id),insertBookingInfo(item)})):console.error("Fetch failed:",requestBookingData);const acceptedBookingResponse=await fetch(`${supabaseUrl}/rest/v1/acceptedBooking?start_time=gte.${getPreviousMonday(currentDate)}&start_time=lte.${getNextSunday(currentDate)}`,{method:"GET",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"}}),acceptedBookingData=await acceptedBookingResponse.json();acceptedBookingResponse.ok?acceptedBookingData.forEach((item=>{const day=new Date(item.start_time).toLocaleString("en",{weekday:"long"}).toLowerCase(),start_time=item.start_time.split("T")[1].slice(0,-3),duration=item.duration;supabaseData.push(item),addTimeToKaldender(day,start_time,duration,!1,"#1a2663","A"+item.id),insertBookingInfo(item,!1)})):console.error("Fetch failed:",acceptedBookingData)}function serviceNameAndCounts(services){const counts={};services.forEach((item=>{counts[item.service]=(counts[item.service]||0)+1}));let returnString="";for(const[service,count]of Object.entries(counts))returnString+=`${service} x ${count} <br>`;return returnString}function dateToString(date,time=!1){if(date=new Date(date),time){return`${date.getHours().toString().padStart(2,"0")}:${date.getMinutes().toString().padStart(2,"0")}`}return`${date.getDate()} ${date.toLocaleString("en",{month:"short"})}, ${date.getFullYear()}`}function toEndTime(time,duration){const timeSplit=time.split(":"),hours=Number(timeSplit[0])+Math.floor(duration/60),minutes=Number(timeSplit[1])+duration%60;return 0==minutes?`${hours}:00`:`${hours}:${minutes}`}function location_for_work(address){return null==address||","==address.trim()||""==address.trim()||null==address?"Ikke udfyldt":address}function acceptRejectButtons(requested){return requested?'\n        <span class="reject-accept">\n            <div class="reject">    \n                <img src="svg/kryds.svg" alt="rejectBooking">\n            </div>\n            <div class="accept">\n                <img src="svg/tjeck.svg" alt="acceptBooking">\n            </div>\n        </span>':""}function textArea(message){return null==message||""==message.trim()||null==message?"":`<textarea readonly class="message">${message}</textarea>`}function calcHeightOnChildItems(currentActiveTab){currentActiveTab.querySelectorAll(".booking-item").forEach((item=>{calculateheight(item.id.replace("ADMIN",""))}))}function calculateheight(id){const item=document.getElementById("ADMIN"+id);if(item.classList.contains("calculated"))return;console.log(id),item.classList.add("calculated");const body=item.querySelector(".booking-body"),bodyHeight=body.getBoundingClientRect().height,servicesHeight=item.querySelector(".service").getBoundingClientRect().height,nameHeight=item.querySelector(".name").getBoundingClientRect().height,locationHeight=item.querySelector(".location").getBoundingClientRect().height,height=Math.round(servicesHeight>nameHeight+locationHeight+16?servicesHeight:nameHeight+locationHeight+16),arrow=item.querySelector(".arrow");arrow.addEventListener("click",(()=>{body.style.height==Math.round(height)+"px"?(body.style.height=bodyHeight+"px",arrow.style.transform="rotate(180deg)"):(body.style.height=height+"px",arrow.style.transform="rotate(0deg)")})),body.style.height=height+"px"}function insertBookingInfo(item,requested=!0){const appendIn=requested?document.getElementById("requested"):document.getElementById("accepteret"),id=requested?"R"+item.id:"A"+item.id,booking=`\n    <div class="booking-item" id="ADMIN${id}">\n        <div class="booking-header">\n            <span>\n                <p class="id">ID ${id}</p>\n                <p class="make-bigger">${dateToString(item.start_time,!1)}</p>\n                <p class="make-bigger">Kl. ${dateToString(item.start_time,!0)} - ${toEndTime(dateToString(item.start_time,!0),item.duration)}</p>\n            </span> \n            ${acceptRejectButtons(requested)}\n        </div>\n        <div class="booking-body">\n            <div class="booking-info">\n                <div class="services">\n                    <p class="service">${serviceNameAndCounts(item.services)}</p>\n                    ${textArea(item.message)}\n                </div>\n                <div>\n                    <p>Adresse:</p>\n                    <p>${item.adress}</p>\n                </div>\n            </div>\n            <div class="booking-contact">\n                <p class="name">${item.fulde_navn}</p>\n                <div class="location">\n                    <p>Udkørsel:</p>\n                    <p>${location_for_work(item.location_for_work)}</p>\n                </div>\n                <div>\n                    <p>Kontakt:</p>\n                    <p>tlf. nr. ${item.tlf}</p>\n                    <p>${item.email}</p>\n                </div>\n            </div>\n        </div>\n        <div class="arrow">\n            <img src="svg/arrow-down.svg" alt="acceptBooking">\n        </div>\n    </div>`;appendIn.insertAdjacentHTML("beforeend",booking),requested&&setTimeout((()=>calculateheight(id)),0),requested&&setTimeout((()=>async function(id,bookingInfo){const{access_token:access_token}=await adminLogin(),bookingid=bookingInfo.id;delete bookingInfo.id;const item=document.getElementById("ADMIN"+id),reject=item.querySelector(".reject"),accept=item.querySelector(".accept");async function deleteBooking(id){const res=await fetch(`${supabaseUrl}/rest/v1/requestBooking?id=eq.${id}`,{method:"DELETE",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"}});return res.ok||console.error("Error deleting booking:",res.status,res.statusText),res.ok}reject.addEventListener("click",(async()=>{await deleteBooking(bookingid)&&(item.remove(),document.getElementById("R"+bookingid).remove(),sendAfvidstMail(bookingInfo.fulde_navn,bookingInfo.email))})),accept.addEventListener("click",(async()=>{const acceptedBookingResponse=await fetch(`${supabaseUrl}/rest/v1/acceptedBooking`,{method:"POST",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"},body:JSON.stringify([bookingInfo])});if(acceptedBookingResponse.ok){const insertedRow=(await acceptedBookingResponse.json())[0];insertBookingInfo(insertedRow,!1);const day=new Date(insertedRow.start_time).toLocaleString("en",{weekday:"long"}).toLowerCase(),start_time=insertedRow.start_time.split("T")[1].slice(0,-3);await deleteBooking(bookingid)?(item.remove(),document.getElementById("R"+bookingid).remove(),addTimeToKaldender(day,start_time,insertedRow.duration,!1,"#1a2663","A"+insertedRow.id),sendGodkendtMail(insertedRow.fulde_navn,insertedRow.email,insertedRow.start_time.split("T")[0],start_time,serviceNameAndCounts(insertedRow.services))):alert("Crital error, kontakt din administrator")}else alert("Noget gik galt, prøv igen eller genindlæs din browser")}))}(id,item)),0)}function validateBooking(giveMessage=!1){return giveMessage&&alert("Booking auto valideret"),!0}function sendAfvidstMail(name,email){emailjs.init("8on1XAeHXO55DA6Tp");const email_info={name:name,email:email};emailjs.send("service_kesfnw1","template_odhfxvo",email_info).then((()=>{console.log("SUCCESS!")}),(error=>{console.log("FAILED...",error)}))}function sendGodkendtMail(name,email,dato,tid,ydelse){emailjs.init("8on1XAeHXO55DA6Tp");const email_info={name:name,email:email,dato:dato,tid:tid,ydelse:ydelse};console.log(email_info)}