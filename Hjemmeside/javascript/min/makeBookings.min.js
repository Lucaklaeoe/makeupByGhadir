var BookingInfo={};async function makeRequestBooking(){const{access_token:access_token,logged_in_via:logged_in_via}=await signIn();fillFormAndCheck()&&(("anonymous@example.com"==logged_in_via?await fetch(`${supabaseUrl}/rest/v1/requestBooking`,{method:"POST",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"},body:JSON.stringify([{...BookingInfo}])}):await fetch(`${supabaseUrl}/rest/v1/acceptedBooking`,{method:"POST",headers:{"Content-Type":"application/json",apikey:supabaseKey,Authorization:`Bearer ${access_token}`,Prefer:"return=representation"},body:JSON.stringify([{...BookingInfo}])})).ok?(window.location="bookingConfirmed.html",sendMail()):alert("Noget gik galt, prøv igen"))}function formIsFilled(){const requiredFields=document.querySelectorAll("[required]");var return_this=!0;requiredFields.forEach((field=>{""!=field.value.trim()&&null!=field.value&&null!=field.value||(return_this=!1)}));return document.getElementById("sammentygge").checked||(return_this=!1),return_this}function fillFormAndCheck(giveMessage=!0){BookingInfo={};document.querySelectorAll("[required]").forEach((field=>{""==field.value.trim()||null==field.value||null==field.value?(field.classList.add("not-filled"),field.addEventListener("input",(()=>{field.classList.remove("not-filled")}))):field.classList.contains("not-filled")&&field.classList.remove("not-filled")}));if(!document.getElementById("sammentygge").checked)return!1;if(document.querySelector(".not-filled"))return!1;const selectedServices=JSON.parse(localStorage.getItem("selectedservices"));if(!selectedServices)return giveMessage&&alert("Du mangler at vælge en service"),window.location="booking.html",!1;const email=document.getElementById("email").value,fulde_navn=document.getElementById("fullname").value,tlf=document.getElementById("tlf").value,start_time=selectedServices.datetime,duration=selectedServices.totalTime,adress=document.getElementById("autocomplete_adresse").value,houseNumber=document.getElementById("autocomplete_house_number").value,postalcode=document.getElementById("autocomplete_postal_code").value,by=document.getElementById("autocomplete_by").value,udAdress=document.getElementById("ud_adress").value||"",udHouseNumber=document.getElementById("ud_husnummer").value||"",udPostalcode=document.getElementById("ud_postal_code").value||"",udBy=document.getElementById("ud_by").value||"",message=document.getElementById("message").value||"",services=selectedServices.services;return BookingInfo={email:email,fulde_navn:fulde_navn,tlf:tlf,start_time:start_time,duration:duration,adress:`${adress} ${houseNumber}, ${postalcode} ${by}`,location_for_work:`${udAdress} ${udHouseNumber}, ${udPostalcode} ${udBy}`,message:message,services:services},!0}function sendMail(){emailjs.init("8on1XAeHXO55DA6Tp");const email_info={name:document.getElementById("fullname").value,email:document.getElementById("email").value};emailjs.send("service_kesfnw1","template_h23bpoo",email_info).then((()=>{console.log("SUCCESS!")}),(error=>{console.log("FAILED...",error)}))}document.addEventListener("DOMContentLoaded",(()=>{function activateSubmitButton(){if(formIsFilled()){document.getElementById("make_booking").classList.remove("disabled")}else{const submitButton=document.getElementById("make_booking");if(submitButton.classList.contains("disabled"))return;submitButton.classList.add("disabled")}}document.querySelectorAll("[required]").forEach((field=>{field.addEventListener("blur",(event=>{event.preventDefault(),activateSubmitButton()}))}));document.getElementById("sammentygge").addEventListener("change",(event=>{event.preventDefault(),activateSubmitButton()}))})),document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("make_booking").addEventListener("click",(event=>{event.preventDefault(),makeRequestBooking()}))}));